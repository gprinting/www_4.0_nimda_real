<?
 /***********************************************************************************
 *** 프로 젝트 : CyPress
 *** 개발 영역 : 주문취소요청
 *** 개  발  자 : 김성진
 *** 개발 날짜 : 2016.06.21
 ***********************************************************************************/

 /***********************************************************************************
 *** 기본 인클루드
 ***********************************************************************************/

 $curDirectory = dirname(__FILE__);
 require_once $curDirectory."/config/set/webinfo/init.php";
 require_once $curDirectory."/config/lib/local/include.php";


 /***********************************************************************************
 *** 리퀘스트
 ***********************************************************************************/

 $OrderNum  = $CCommon->STags($CRequest->GetValue("OrderNum"));
 $WorkerID  = $CCommon->STags($CRequest->GetValue("WorkerID"));


  /***********************************************************************************
 *** 변수값 유무 체크
 ***********************************************************************************/

 if (strlen($OrderNum) <= 0 || strlen($WorkerID) <= 0) {
	 echo "Res="._CYP_ORD_NUM_ERR_CD_01."&"._CYP_ORD_NUM_ERR_DC_01;
	 exit;
 }


 /***********************************************************************************
 *** 변수 정의
 ***********************************************************************************/

 $rData['order_num']  = $OrderNum;
 $rData['work_id']  = iconv("euckr", "utf-8", $WorkerID);


 /***********************************************************************************
 *** 모듈 인클루드
 ***********************************************************************************/

 require_once _MOD_DIR."/mod_order.php";
 $COrder = new CLS_Order;


 /***********************************************************************************
 *** 주문취소 체크
 ***********************************************************************************/

 $chkRes = $COrder->getOrderCancelDataCheck(_DB_SERVER, $rData);


 /***********************************************************************************
 *** 결과
 ***********************************************************************************/

 if ($chkRes == "SUCCESS") {
	 $ordRes = $COrder->setOrderCancelDataUpdateComplete(_DB_SERVER, $rData);

	 if ($ordRes == "SUCCESS") {
		 $nRes = _CYP_SUCCESS;
	 } else {
		 $nRes = _CYP_COMM_ERR_CD_02."&"._CYP_COMM_ERR_DC_02;
	 }
 } else if ($chkRes == "FAILED") {
	 $nRes = _CYP_ORD_NUM_ERR_CD_03."&"._CYP_ORD_NUM_ERR_DC_03;
 } else if ($chkRes == "ERROR") {
	 $nRes = _CYP_COMM_ERR_CD_01."&"._CYP_COMM_ERR_DC_01;
 } else {
	 $nRes = _CYP_COMM_ERR_CD_02."&"._CYP_COMM_ERR_DC_02;
 }


  /***********************************************************************************
 *** 출력
 ***********************************************************************************/

 echo "Res=".$nRes."\n";

?>